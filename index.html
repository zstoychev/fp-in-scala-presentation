<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Функционално програмиране със Scala</title>

		<meta name="description" content="Функционално програмиране със Scala">
		<meta name="author" content="Здравко Стойчев">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css" id="theme">
        <link rel="stylesheet" href="css/scala.css">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h2>Функционално програмиране със Scala</h2>
				</section>

				<section>
					<h2>За мен</h2>
                    <p>Здравко Стойчев</p>
                    <p><img src="images/zdravko.jpg" alt="" /></p>
                    <p>
                        <img src="images/sofia-university.png" height="150" class="ref-image" style="background-color: white" alt="" />
                        <img src="images/obecto-logo.png" height="150" class="ref-image" alt=""/>
                    </p>
                    <p><a href="https://github.com/zstoychev">github.com/zstoychev</a></p>
				</section>

                <section>
                    <h2>Защо функционално програмиране?</h2>
                    <ul>
                        <li class="fragment">Преизползваем, тестваем и ясен код</li>
                        <li class="fragment">ООП не обещаваше ли същото?</li>
                        <li class="fragment">Силно приложимо в големи и дистрибутирани системи</li>
                        <li class="fragment">Код, който доста по-лесно може да проследим и към който да приложим математически доказателства</li>
                        <li class="fragment">Забавно</li>
                    </ul>
                    <p class="fragment">Disclaimer: Изисква се време за промяна на начинът на мислене.</p>
                </section>

                <section>
                    <h2>Защо <img class="ref-image" src="images/scala-logo.png" style="display: inline-block; height: 64px; vertical-align: middle; margin: -8px 2px 0 0" alt="" />Scala?</h2>
                    <p style="float: right"><img src="images/odersky.jpg" style="height: 400px" /></p>
                    <ul>
                        <li>ФП + ООП</li>
                        <li>SCAlable LAnguage</li>
                    </ul>
                </section>

                <section>
                    <h2>Какво е функция?</h2>
                    <ul>
                        <li class="fragment">Нека X и Y са множества, а f ⊆ X × Y е релация, такава че ∀ x ∈ X ∃! y ∈ Y, такова че (x, y) ∈ f. Тогава f наричаме функция.</li>
                        <li class="fragment">Изображение на елементите на едно множество X (вход) към елементи на друго множество Y (изход)</li>
                        <li class="fragment">f(x) => y, x ∈ X, y ∈ Y</li>
                    </ul>
                </section>

                <section>
                    <h2>Функционално програмиране</h2>
                    <ul>
                        <li class="fragment">Функциите са първокласни обекти</li>
                        <li class="fragment">Неизменяемост и липса на странични ефекти</li>
                        <li class="fragment">Силна типова система</li>
                    </ul>
                </section>

                <section>
                    <h2>Странични ефекти, състояние и стойности</h2>
                    <p><img src="images/rich-hickey.jpg" style="height: 400px" alt="" /></p>
                    <p><a href="http://www.infoq.com/presentations/Value-Values">The Value of Values</a><br /><a href="http://clojure.org/state">http://clojure.org/state</a></p>
                </section>

                <section>
                    <h2>Типова система</h2>
                    <p><img src="images/alan-kay.jpg" alt="" /></p>
                    <blockquote cite="http://www.purl.org/stefan_ram/pub/doc_kay_oop_en">
                        &ldquo;I’m not against types, but I don’t know of any type systems that aren’t a complete pain, so I still like dynamic typing.&rdquo;
                    </blockquote>
                </section>

                <section>
                    <h2>Scala (demo)</h2>
                </section>

                <section>
                    <h2>Йеархия на Scala</h2>
                    <p><img src="images/scala-hierarchy.jpg" alt="" /></p>
                </section>

                <section>
                    <section>
                        <p>people – списък от хора. Намерете имената на всички хора, които са по-млади от 25 години</p>
                        <pre class="fragment"><code class="java">List&lt;String&gt; result = new ArrayList&lt;&gt;();

for (Person person : people) {
    if (person.getAge() &lt; 25) {
        result.add(person.getName());
    }
}

return result</code></pre>
                    </section>

                    <section>
                        <p>Нека имаме числата от 1 до 100, Генерирайте списък от тях, в който числата, които се делят на 3, са заменени от думата Fizz, тези на 5 – от Buzz, а тези и на 3 и на 5 са премахнати.</p>
                        <pre class="fragment"><code class="java">List&lt;Object&gt; result = new ArrayList&lt;&gt;();

for (int i = 1; i &lt; 100; i++) {
    if (!(i % 5 == 0 && i % 3 == 0)) {
        Object newItem;

        if (i % 3 == 0) {
            newItem = "Fizz":
        } else if (i % 5 == 0) {
            newItem = "Buzz";
        } else {
            newItem = i;
        }

        result.add(newItem);
    }
}

return result;</code></pre>
                    </section>

                    <section>
                        <p>Намерете квадратите на първите 20 четни числа на фибоначи.</p>
                    </section>

                    <section>
                        <p>Инцидентна сложност срещу съществена сложност</p>
                    </section>
                </section>

                <section>
                    <section>
                        <h2>Композитност на функции</h2>
                        <p>Ако имаме функции f: A => B и g: B => C, то</p>
                        <p>h(x) = g(f(x)) е функция A => C</p>
                        <p>h = g ∘ f</p>
                    </section>

                    <section>
                        <h2>Композитност на функции</h2>
                        <p>Асоциативност – нека f: A => B, g: B => C и h: C => D. Тогава</p>
                        <pre><code class="nohighlight">(h ∘ g) ∘ f = h ∘ (g ∘ f)</code></pre>
                        <p>Нека identity = x => x. Тогава ∀ f</p>
                        <pre><code class="nohighlight">identity ∘ f = f ∘ identity = f</code></pre>
                    </section>
                </section>

                <section>
                    <div class="pre"><code class="java">List&lt;String&gt; result = new ArrayList&lt;&gt;();

for (Person person : people) {
    if (<span class="emphasized">person.getAge() &lt; 25</span>) {
        result.add(<span class="emphasized">person.getName()</span>);
    }
}

return result</code></div>
                    <div class="pre"><code class="java">List&lt;Object&gt; result = new ArrayList&lt;&gt;();

for (int i = 1; i &lt;= 100; i++) {
    if (<span class="emphasized">!(i % 5 == 0 && i % 3 == 0)</span>) {
<span style="display: block" class="emphasized">        Object newItem;

        if (i % 3 == 0) {
            newItem = "Fizz":
        } else if (i % 5 == 0) {
            newItem = "Buzz";
        } else {
            newItem = i;
        }</span>

        result.add(newItem);
    }
}

return result;</code></div>
                </section>

                <section>
                    <h2>Функции от по-висок ред</h2>
                    <pre><code class="scala">def map[A, B](xs: List[A])(f: A => B): List[B]</code></pre>
                    <pre><code class="scala">def filter[A](xs: List[A])(f: A => Boolean): List[A]</code></pre>
                    <pre class="fragment"><code class="scala">def map[A, B](xs: List[A])(f: A => B): List[B] = {
  var result: List[B] = Nil

  for (e &lt;- xs) {
    result = result :+ f(e)
  }

  result
}

def filter[A](xs: List[A])(f: A => Boolean): List[A] = {
  var result: List[A] = Nil

  for {
    e &lt;- xs
    if f(e)
  } result = result :+ e

  result
}</code></pre>
                    <p class="fragment">Съществува по-идеоматична имплементация</p>
                </section>

                <section>
                    <section>
                        <pre style="width: 100%"><code class="scala">def buyTea(cc: CreditCard, paymentService: PaymentService): Tea = {
  val teaCup = new Tea(...)
  paymentService.charge(cc, teaCup.price)
  teaCup
}</code></pre>
                    </section>

                    <section>
                        <pre><code class="scala">case class Charge(cc: CreditCard, amount: Double)

def buyTea(cc: CreditCard): (Tea, Charge) = {
  val teaCup = new Tea(...)
  (teaCup, Charge(cc, teatCup.price)
}</code></pre>
                    </section>

                    <section>
                        <pre><code class="scala">case class Charge(cc: CreditCard, amount: Double) {
  def combine(other: Charge): Charge = {
    require(cc == other.cc)
    Charge(cc, amount + other.amount)
  }
}</code></pre>
                    </section>

                    <section>
                        <pre><code class="scala">def buyTeas(cc: CreditCard, n: Int): (List[Tea], Charge) = {
  val (teas, charges) = List.fill(n)(buyCoffee(cc)).unzip

  (teas, charges.reduce(_ combine _))
}</code></pre>
                    </section>

                    <section>
                        <pre><code class="scala">def coalesce(charges: List[Charge]): List[Charge] = {
  charges.groupBy(_.cc).values.map(_.reduce(_ combine _)).toList
}

def avgPerClient(charges: List[Charge]): Double {
  val combined = coalesce(charges)
  combined.map(_.amount).sum / combined.size
}</code></pre>
                        <p class="fragment">Извод: много често малки домейн обекти остават скрити в нашите имплементации.
                        Ако се премахнат страничните ефекти кодът става доста по-преизползваем, а ползата от тези обекти става осезаема.</p>
                    </section>

                    <section>
                        <p><a href="http://www.manning.com/ghosh2/"><img height="400" src="images/functional-reactive-domain-modeling.jpeg" alt="" /></a></p>
                    </section>
                </section>

                <section>
                    <section>
                        <h2>Неизменяемост и липса на странични ефекти</h2>
                    </section>

                    <section>
                        <h2>Персистентни структури</h2>
                    </section>

                    <section>
                        <pre><code class="scala">val a = List(1, 2, 3)
val b = 4 :: a
val c = 5 :: a.tail</code></pre>
                        <p><img src="images/list.png" alt="" /></p>
                    </section>

                    <section>
                        <h2>Неизменяеми структури</h2>

                        <table>
                            <tr>
                                <th></th>
                                <th>head</th>
                                <th>tail</th>
                                <th>apply</th>
                                <th>update</th>
                                <th>prepend</th>
                                <th>append</th>
                                <th>insert</th>
                            </tr>
                            <tr>
                                <td>List</td>
                                <td>C</td>
                                <td>C</td>
                                <td>L</td>
                                <td>L</td>
                                <td>C</td>
                                <td>L</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>Vector</td>
                                <td>eC</td>
                                <td>eC</td>
                                <td>eC</td>
                                <td>eC</td>
                                <td>eC</td>
                                <td>eC</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>Queue</td>
                                <td>aC</td>
                                <td>aC</td>
                                <td>L</td>
                                <td>L</td>
                                <td>L</td>
                                <td>C</td>
                                <td>-</td>
                            </tr>
                        </table>

                        <table>
                            <tr>
                                <th></th>
                                <th>lookup</th>
                                <th>add</th>
                                <th>remove</th>
                                <th>min</th>
                            </tr>
                            <tr>
                                <td>HashSet/HashMap</td>
                                <td>eC</td>
                                <td>eC</td>
                                <td>eC</td>
                                <td>L</td>
                            </tr>
                            <tr>
                                <td>TreeSet/TreeMap</td>
                                <td>Log</td>
                                <td>Log</td>
                                <td>Log</td>
                                <td>Log</td>
                            </tr>
                        </table>
                    </section>

                    <section>
                        <h2>Изменяеми структури</h2>

                        <table>
                            <tr>
                                <th></th>
                                <th>head</th>
                                <th>tail</th>
                                <th>apply</th>
                                <th>update</th>
                                <th>prepend</th>
                                <th>append</th>
                                <th>insert</th>
                            </tr>
                            <tr>
                                <td>ListBuffer</td>
                                <td>C</td>
                                <td>L</td>
                                <td>L</td>
                                <td>L</td>
                                <td>C</td>
                                <td>C</td>
                                <td>L</td>
                            </tr>
                            <tr>
                                <td>ArrayBuffer</td>
                                <td>C</td>
                                <td>L</td>
                                <td>C</td>
                                <td>C</td>
                                <td>L</td>
                                <td>aC</td>
                                <td>L</td>
                            </tr>
                            <tr>
                                <td>Queue</td>
                                <td>C</td>
                                <td>L</td>
                                <td>L</td>
                                <td>L</td>
                                <td>C</td>
                                <td>C</td>
                                <td>L</td>
                            </tr>
                        </table>

                        <table>
                            <tr>
                                <th></th>
                                <th>lookup</th>
                                <th>add</th>
                                <th>remove</th>
                                <th>min</th>
                            </tr>
                            <tr>
                                <td>HashSet/HashMap</td>
                                <td>eC</td>
                                <td>eC</td>
                                <td>eC</td>
                                <td>L</td>
                            </tr>
                            <tr>
                                <td>TreeSet/TreeMap</td>
                                <td>Log</td>
                                <td>Log</td>
                                <td>Log</td>
                                <td>Log</td>
                            </tr>
                        </table>
                    </section>

                    <section>
                        <p><a href="http://www.goodreads.com/book/show/594288.Purely_Functional_Data_Structures"><img src="images/functional-data-structures.jpg" height="500" alt="" /></a></p>
                    </section>
                </section>

                <section>
                    <section>
                        <h2>Опционалност</h2>
                        <p>Кое изключение срещате най-често?</p>
                        <p class="fragment" style="font-weight: bold; font-size: 72px">NullPointerException</p>
                    </section>
                    <section>
                        <blockquote>
                            &ldquo;I call it my billion-dollar mistake. It was the invention of the null reference in 1965. ... But I couldn't resist the temptation to put in a null reference, simply because it was so easy to implement. This has led to innumerable errors, vulnerabilities, and system crashes, which have probably caused a billion dollars of pain and damage in the last forty years.&rdquo;
                        </blockquote>
                        <p><a href="http://www.infoq.com/presentations/Null-References-The-Billion-Dollar-Mistake-Tony-Hoare">–– Tony Hoare</a></p>
                    </section>

                    <section>
                        <h2>Опционалност</h2>
                        <pre><code class="scala">sealed abstract class Option[+A]
case class Some[+A](x: A) extends Option[A]
case object None extends Option[Nothing]</code></pre>
                    </section>
                </section>

                <section>
                    <h2>Type Classes</h2>
                </section>

                <section>
                    <section>
                        <h2>Група</h2>
                        <p>Нека G е множество с бинарна операция op. G наричаме група, ако:</p>
                        <ul>
                            <li>асоциативност – ∀ a, b, c ∈ G:<pre><code class="scala">op(op(a, b), c) = op(a, op(b, c))</code></pre></li>
                            <li>неутрален елемент – ∃ e ∈ G, такъв че ∀ a ∈ G<pre><code class="scala">op(e, a) = op(a, e) = a</code></pre></li>
                            <li>обратен елемент – ∀ a ∈ G, ∃ a' ∈ G, такъв че<pre><code class="scala">op(a, a') = op(a', a) = e</code></pre></li>
                        </ul>
                    </section>
                    <section>
                        <h2>Моноид</h2>
                        <p>Нека M е множество с бинарна операция op. M наричаме моноид, ако:</p>
                        <ul>
                            <li>асоциативност – ∀ a, b, c ∈ M:<pre><code class="scala">op(op(a, b), c) = op(a, op(b, c))</code></pre></li>
                            <li>неутрален елемент – ∃ e ∈ M, такъв че ∀ a ∈ M<pre><code class="scala">op(e, a) = op(a, e) = a</code></pre></li>
                            <li><del>обратен елемент – ∀ a ∈ M, ∃ a' ∈ M, такъв че<pre><code class="scala">op(a, a') = op(a', a) = e</code></pre></del></li>
                        </ul>
                    </section>
                </section>

                <section>
                    <section>
                        <h2>Монад</h2>
                        <div>f: A => M[B]</div>
                        <div>g: B => M[C]</div>
                        <div class="fragment">compose(f, g)?</div>
                    </section>

                    <section>
                        <h2>Монад</h2>
                        <p>Асоциативност</p>
                        <pre><code class="scala">compose(compose(f, g), h) = compose(f, compose(g, h))</code></pre>
                        <p>Неутрален елемент unit: A => F[A]</p>
                        <pre><code class="scala">compose(unit, f) = compose(f, unit) = f</code></pre>
                    </section>

                    <section>
                        <h2>Монад</h2>
                        <pre><code class="scala">trait Monad[F[_]] {
  def compose[A, B, C](f: A => F[B], g: B => F[C]): A => F[C]
  def unit[A](a: A): F[A]
}</code></pre>
                    </section>

                    <section>
                        <h2>Монад</h2>
                        <pre style="width: 100%"><code class="scala">trait Monad[F[_]] {
  def flatMap[A, B](m: F[A])(f: A => F[B]): F[B]
  def compose[A, B, C](f: A => F[B], g: B => F[C]): A => F[C] = { a =>
    flatMap(f(a))(g)
  }
  def unit[A](a: A): F[A]
}</code></pre>
                    </section>

                    <section>
                        <h2>Монад</h2>
                        <ul>
                            <li>асоциативност<pre style="width: 100%"><code class="scala">m.flatMap(f).flatMap(g) ≡ m.flatMap(x => f(x).flatMap(g))</code></pre></li>
                            <li>лява идентичност<pre><code class="scala">unit(x).flatMap(f) ≡ f(x)</code></pre></li>
                            <li>дясна идентичност<pre><code class="scala">m.flatMap(unit) ≡ m</code></pre></li>
                        </ul>
                    </section>
                </section>

                <section>
                    <pre style="width: 100%"><code>def validPerson(name: String, birthdate: Date, phone: String): Person = {
  validateName(name),
  validateBirthdate(birthdate),
  validatePhone(phone)

  Person(name, birthday, phone)
}</code></pre>
                    <pre style="width: 100%" class="fragment"><code>def validPerson(name: String, birthdate: Date, phone: String): Validation[String, Person] = {
  map3(
    validName(name),
    validBirthdate(birthdate),
    validPhone(phone)
  ) (Person _)
}</code></pre>
                </section>

                <section>
                    <h2>Моделиране на състояние</h2>
                    <ul>
                        <li>Ефекти, скрити зад монади</li>
                        <li>Актьори</li>
                        <li>Software Transactional Memory</li>
                        <li>Functional Reactive Programming (<a href="http://www.infoq.com/presentations/elm-reactive-programming">Марио с FRP</a>)</li>
                        <li>Функционални потоци</li>
                        <li>Communicating Sequential Channels</li>
                    </ul>
                </section>

                <section>
                    <section>
                        <h2>Pattern Matching</h2>
                    </section>

                    <section>
                        <pre><code class="scala">def quickSort[T &lt;% Ordered[T]](xs: List[T]): List[T] = xs match {
  case Nil => Nil
  case x :: rest => {
    val (before, after) = rest partition { _ &lt; x }
    quickSort(before) ++ (x :: quickSort(after))
  }
}</code></pre>
                    </section>

                    <section>
                        <pre><code class="scala">def mergeSort[T &lt;% Ordered[T]](xs: List[T]): List[T] = {
  def merge(xs: List[T], ys: List[T]): List[T] = (xs, ys) match {
    case (Nil, _) => ys
    case (_, Nil) => xs
    case (x :: xrest, y :: yrest) =>
      if (x &lt; y) x :: merge(xrest, ys)
      else y :: merge(xs, yrest)
  }

  if (xs.length == 0) xs
  else {
    val (left, right) = xs splitAt (xs.length / 2)
    merge(mergeSort(left), mergeSort(right))
  }
}</code></pre>
                    </section>
                </section>

                <section>
                    <section>
                        <h2>The Expression Problem</h2>
                        <ul>
                            <li class="fragment">Define a type with a set of subtype and set of operations</li>
                            <li class="fragment">Add new subtype</li>
                            <li class="fragment">Add new operation over the type</li>
                            <li class="fragment">Don’t recompile the existing modules</li>
                        </ul>
                    </section>
                    <section>
                        <h2>The Expression Problem</h2>
                        <ul>
                            <li>ООП – лесно се добавя нов подтип, трудно се добавя нова операция</li>
                            <li>Pattern Matching – лесно се добавя нова операция, трудно се добавя нов подтип</li>
                        </ul>
                        <p class="fragment">Хубаво е един език да предоставя конструкции и за двете.</p>
                    </section>
                </section>

                <section>
                    <h2>Книги</h2
                    <p>
                        <a href="http://www.artima.com/shop/programming_in_scala_2ed"><img height="400" src="images/programming-in-scala.png" alt="" /></a>
                        <a href="http://www.manning.com/bjarnason/"><img height="400" src="images/functional-programming-in-scala.jpg" alt="" /></a>
                    </p>
                </section>

                <section>
                    <h2>Въпроси</h2>
                    <h2>???</h2>
                </section>
		    </div>
        </div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'fade', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

        <script src="js/jquery-2.1.3.min.js"></script>
        <script>
            $(document).ready(function() {
                $('pre code,.pre code').each(function(i, block) {
                    hljs.highlightBlock(block);
                });
            });
        </script>

	</body>
</html>
